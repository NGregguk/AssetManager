@model IReadOnlyList<asset_manager.Models.GuideCategory>
@{
    ViewData["Title"] = "Guides";
}

<section class="page-header">
    <div>
        <h1>Guides</h1>
        <p class="muted">Create and organize admin-only guides.</p>
    </div>
    <div class="header-actions">
        <a class="button ghost" asp-area="Admin" asp-controller="Home" asp-action="Index">Back to admin</a>
        <a class="button ghost" asp-area="Admin" asp-controller="GuideCategories" asp-action="Index">Manage categories</a>
        <a class="button" asp-area="Admin" asp-controller="Guides" asp-action="Create">Add guide</a>
    </div>
</section>

@if (Model.Count == 0)
{
    <div class="panel">
        <p class="muted">No guide categories yet. Create a category to start adding guides.</p>
        <a class="button" asp-area="Admin" asp-controller="GuideCategories" asp-action="Create">Add category</a>
    </div>
}
else
{
    foreach (var category in Model)
    {
        var guides = category.Guides
            .OrderBy(g => g.SortOrder)
            .ThenBy(g => g.Title)
            .ToList();

        <section class="panel">
            <div class="panel-header">
                <div>
                    <h2>@category.Name</h2>
                    @if (!string.IsNullOrWhiteSpace(category.Description))
                    {
                        <p class="muted">@category.Description</p>
                    }
                </div>
                <div class="header-actions">
                    <a class="button ghost small" asp-area="Admin" asp-controller="GuideCategories" asp-action="Edit" asp-route-id="@category.Id">Edit category</a>
                    <a class="button small" asp-area="Admin" asp-controller="Guides" asp-action="Create" asp-route-categoryId="@category.Id">Add guide</a>
                </div>
            </div>
            @if (guides.Count == 0)
            {
                <div class="empty-state">No guides in this category yet.</div>
            }
            else
            {
                <div class="table-wrap">
                    <table class="table table-borderless align-middle">
                        <thead>
                            <tr>
                                <th>Guide</th>
                                <th>Summary</th>
                                <th class="text-center">Order</th>
                                <th class="text-center">Updated</th>
                                <th class="text-end">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                        @foreach (var guide in guides)
                        {
                            <tr>
                                <td class="asset-name">@guide.Title</td>
                                <td class="muted">@guide.Summary</td>
                                <td class="text-center">@guide.SortOrder</td>
                                <td class="text-center">@guide.UpdatedAt.ToLocalTime().ToString("dd MMM yyyy")</td>
                                <td class="text-end">
                                    <a class="button ghost small" asp-area="Admin" asp-controller="Guides" asp-action="Details" asp-route-id="@guide.Id">View</a>
                                    <a class="button ghost small" asp-area="Admin" asp-controller="Guides" asp-action="Edit" asp-route-id="@guide.Id">Edit</a>
                                    <a class="button danger small" asp-area="Admin" asp-controller="Guides" asp-action="Delete" asp-route-id="@guide.Id">Delete</a>
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                </div>
            }
        </section>
    }
}
